{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/kushagraverma/Desktop/Neural%20Pulse/Oriondiamonds/src/queries/customer.js"],"sourcesContent":["// src/queries/customer.js\nexport const CUSTOMER_CREATE = `\n  mutation customerCreate($input: CustomerCreateInput!) {\n    customerCreate(input: $input) {\n      customer {\n        id\n        email\n        firstName\n        lastName\n      }\n      customerUserErrors {\n        message\n      }\n    }\n  }\n`;\n\nexport const CUSTOMER_LOGIN = `\n  mutation customerAccessTokenCreate($input: CustomerAccessTokenCreateInput!) {\n    customerAccessTokenCreate(input: $input) {\n      customerAccessToken {\n        accessToken\n        expiresAt\n      }\n      customerUserErrors {\n        message\n      }\n    }\n  }\n`;\n\nexport const GET_CUSTOMER_INFO = `\n  query getCustomer($customerAccessToken: String!) {\n    customer(customerAccessToken: $customerAccessToken) {\n      id\n      firstName\n      lastName\n      displayName\n      email\n      phone\n      acceptsMarketing\n      createdAt\n      updatedAt\n      defaultAddress {\n        id\n        address1\n        address2\n        city\n        province\n        country\n        zip\n        firstName\n        lastName\n        phone\n      }\n      addresses(first: 10) {\n        edges {\n          node {\n            id\n            address1\n            address2\n            city\n            province\n            country\n            zip\n            firstName\n            lastName\n            phone\n          }\n        }\n      }\n      orders(first: 10) {\n        edges {\n          node {\n            id\n            orderNumber\n            processedAt\n            financialStatus\n            fulfillmentStatus\n            totalPrice {\n              amount\n              currencyCode\n            }\n            lineItems(first: 10) {\n              edges {\n                node {\n                  title\n                  quantity\n                  variant {\n                    id\n                    title\n                    image {\n                      url\n                      altText\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n`;\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;;;;;AACnB,MAAM,kBAAkB,CAAC;;;;;;;;;;;;;;AAchC,CAAC;AAEM,MAAM,iBAAiB,CAAC;;;;;;;;;;;;AAY/B,CAAC;AAEM,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyElC,CAAC","debugId":null}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///Users/kushagraverma/Desktop/Neural%20Pulse/Oriondiamonds/src/app/login/page.jsx"],"sourcesContent":["// src/app/login/page.jsx - Fixed redirect loop\n\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport Image from \"next/image\";\nimport { useRouter } from \"next/navigation\";\nimport { signIn, useSession } from \"next-auth/react\";\nimport { CUSTOMER_CREATE, CUSTOMER_LOGIN } from \"../../queries/customer\";\nimport { shopifyRequest } from \"../../utils/shopify\";\nimport { mergeLocalAndMongoDBCart } from \"../../utils/cartSync\";\nimport toast from \"react-hot-toast\";\n\nexport default function LoginPage() {\n  const router = useRouter();\n  const { data: session, status } = useSession();\n  const [isLogin, setIsLogin] = useState(true);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n  const hasRedirectedRef = useRef(false); // ðŸ”§ FIX: Prevent multiple redirects\n\n  const [formData, setFormData] = useState({\n    email: \"\",\n    password: \"\",\n    firstName: \"\",\n    lastName: \"\",\n  });\n\n  // ðŸ”§ FIX: Only redirect once when Google auth completes\n  useEffect(() => {\n    if (status === \"authenticated\" && session && !hasRedirectedRef.current) {\n      hasRedirectedRef.current = true;\n\n      // Don't call handleCartSync here - let CartSyncProvider handle it\n      // Just redirect to account\n      toast.success(\"Logged in successfully!\");\n      router.push(\"/account\");\n    }\n  }, [status, session, router]);\n\n  const handleChange = (e) => {\n    setFormData({ ...formData, [e.target.name]: e.target.value });\n    setError(\"\");\n  };\n\n  const handleGoogleSignIn = async () => {\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      await signIn(\"google\", {\n        callbackUrl: \"/account\",\n        redirect: true,\n      });\n    } catch (error) {\n      setError(\"Failed to sign in with Google\");\n      setLoading(false);\n      hasRedirectedRef.current = false;\n    }\n  };\n\n  const handleSignup = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      const { data } = await shopifyRequest(CUSTOMER_CREATE, {\n        input: {\n          email: formData.email,\n          password: formData.password,\n          firstName: formData.firstName,\n          lastName: formData.lastName,\n        },\n      });\n\n      if (data.customerCreate.customerUserErrors.length > 0) {\n        setError(data.customerCreate.customerUserErrors[0].message);\n        setLoading(false);\n        return;\n      }\n\n      toast.success(\"Account created! Logging in...\");\n      await handleLogin(e, true);\n    } catch (err) {\n      console.error(\"Signup error:\", err);\n      setError(\"Something went wrong. Please try again.\");\n      setLoading(false);\n    }\n  };\n\n  const handleLogin = async (e, isAutoLogin = false) => {\n    if (!isAutoLogin) e.preventDefault();\n    setLoading(true);\n    setError(\"\");\n\n    try {\n      const { data } = await shopifyRequest(CUSTOMER_LOGIN, {\n        input: {\n          email: formData.email,\n          password: formData.password,\n        },\n      });\n\n      if (data.customerAccessTokenCreate.customerUserErrors.length > 0) {\n        setError(data.customerAccessTokenCreate.customerUserErrors[0].message);\n        setLoading(false);\n        return;\n      }\n\n      const { accessToken, expiresAt } =\n        data.customerAccessTokenCreate.customerAccessToken;\n\n      localStorage.setItem(\"shopify_customer_token\", accessToken);\n      localStorage.setItem(\"shopify_token_expires\", expiresAt);\n      localStorage.setItem(\"customer_email\", formData.email);\n\n      // ðŸ”§ FIX: Sync cart silently in background\n      toast.loading(\"Syncing your cart...\");\n\n      try {\n        await mergeLocalAndMongoDBCart(formData.email);\n        window.dispatchEvent(new Event(\"cartUpdated\"));\n        toast.dismiss();\n        toast.success(\"Logged in successfully!\");\n      } catch (syncError) {\n        console.error(\"Cart sync error:\", syncError);\n        toast.dismiss();\n        toast.success(\"Logged in successfully!\");\n      }\n\n      // ðŸ”§ FIX: Redirect after a short delay\n      setTimeout(() => {\n        router.push(\"/account\");\n      }, 500);\n    } catch (err) {\n      console.error(\"Login error:\", err);\n      setError(\"Something went wrong. Please try again.\");\n      setLoading(false);\n    }\n  };\n\n  // ðŸ”§ FIX: Don't show loading screen for Google auth\n  // Let the page render normally and handle redirect in useEffect\n\n  return (\n    <div className=\"relative min-h-screen mt-10 flex items-center justify-center bg-[#0a1833] overflow-hidden\">\n      <div className=\"absolute inset-0\">\n        <Image\n          src=\"/new.jpg\"\n          alt=\"Background\"\n          fill\n          className=\"object-cover opacity-40 animate-heroZoomOut\"\n          priority\n        />\n        <div className=\"absolute inset-0 bg-black/50\"></div>\n      </div>\n\n      <div className=\"relative z-10 max-w-md w-full bg-white/90 backdrop-blur-md rounded-2xl shadow-2xl p-10 m-6 text-[#0a1833]\">\n        <h2 className=\"text-center text-4xl font-serif font-semibold mb-2\">\n          {isLogin ? \"Welcome Back\" : \"Create Account\"}\n        </h2>\n        <p className=\"text-center text-gray-600 mb-8\">\n          {isLogin\n            ? \"Sign in to access your Orion Diamonds account\"\n            : \"Join Orion Diamonds â€“ brilliance redefined\"}\n        </p>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4 text-sm\">\n            {error}\n          </div>\n        )}\n\n        <button\n          onClick={handleGoogleSignIn}\n          disabled={loading}\n          className=\"w-full flex items-center justify-center gap-3 bg-white border-2 border-gray-300 text-gray-700 py-2.5 rounded-lg font-medium hover:bg-gray-50 transition disabled:opacity-50 mb-6\"\n        >\n          <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\">\n            <path\n              fill=\"#4285F4\"\n              d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n            />\n            <path\n              fill=\"#34A853\"\n              d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n            />\n            <path\n              fill=\"#FBBC05\"\n              d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n            />\n            <path\n              fill=\"#EA4335\"\n              d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n            />\n          </svg>\n          {loading ? \"Signing in...\" : \"Continue with Google\"}\n        </button>\n\n        <div className=\"relative mb-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <div className=\"w-full border-t border-gray-300\"></div>\n          </div>\n          <div className=\"relative flex justify-center text-sm\">\n            <span className=\"px-2 text-gray-500 bg-white/90\">\n              Or continue with email\n            </span>\n          </div>\n        </div>\n\n        <form\n          className=\"space-y-5\"\n          onSubmit={isLogin ? handleLogin : handleSignup}\n        >\n          {!isLogin && (\n            <div className=\"grid grid-cols-2 gap-3\">\n              <input\n                id=\"firstName\"\n                name=\"firstName\"\n                type=\"text\"\n                required\n                placeholder=\"First Name\"\n                value={formData.firstName}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-[#0a1833] focus:border-[#0a1833] text-sm bg-white/90\"\n              />\n              <input\n                id=\"lastName\"\n                name=\"lastName\"\n                type=\"text\"\n                required\n                placeholder=\"Last Name\"\n                value={formData.lastName}\n                onChange={handleChange}\n                className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-[#0a1833] focus:border-[#0a1833] text-sm bg-white/90\"\n              />\n            </div>\n          )}\n\n          <input\n            id=\"email\"\n            name=\"email\"\n            type=\"email\"\n            required\n            placeholder=\"Email Address\"\n            value={formData.email}\n            onChange={handleChange}\n            className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-[#0a1833] focus:border-[#0a1833] text-sm bg-white/90\"\n          />\n\n          <input\n            id=\"password\"\n            name=\"password\"\n            type=\"password\"\n            required\n            placeholder=\"Password\"\n            value={formData.password}\n            onChange={handleChange}\n            className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-[#0a1833] focus:border-[#0a1833] text-sm bg-white/90\"\n          />\n\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"w-full bg-[#0a1833] text-white py-2.5 rounded-lg font-medium hover:bg-[#142850] transition disabled:opacity-50\"\n          >\n            {loading ? \"Processing...\" : isLogin ? \"Sign In\" : \"Sign Up\"}\n          </button>\n        </form>\n\n        <div className=\"text-center mt-6\">\n          <button\n            type=\"button\"\n            onClick={() => {\n              setIsLogin(!isLogin);\n              setError(\"\");\n            }}\n            className=\"text-[#0a1833] font-medium hover:underline\"\n          >\n            {isLogin\n              ? \"Don't have an account? Sign up\"\n              : \"Already have an account? Sign in\"}\n          </button>\n        </div>\n      </div>\n\n      <style jsx>{`\n        @keyframes heroZoomOut {\n          0% {\n            transform: scale(1.4);\n          }\n          100% {\n            transform: scale(1);\n          }\n        }\n        .animate-heroZoomOut {\n          animation: heroZoomOut 1.8s ease-out forwards;\n        }\n      `}</style>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}